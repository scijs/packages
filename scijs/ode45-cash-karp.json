{"readme":"<h1 class=\"title\"><a target=\"_blank\" href=\"https://github.com/scijs/ode45-cash-karp\">ode45-cash-karp   </a><div class=\"contrib\"></div></h1>\n<blockquote>\n<p>Integrate a system of Ordinary Differential Equations using the Fifth Order Adaptive Cash-Karp method</p>\n</blockquote>\n<h2 id=\"introduction\">Introduction</h2>\n<p>This module integrates a system of ordinary differential equations of the form</p>\n<p align=\"center\"><img alt=\"\\begin{eqnarray*} y&apos;(t) &amp;=&amp; f(t, y(t)), \\\\ y(t_0) &amp;=&amp; y_0 \\end{eqnarray*}\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/begineqnarray-yt-ft-yt-yt_0-y_0-endeqnarray-0298eae3db.png\" width=\"187\" height=\"61\"></p>\n\n<p>where <img alt=\"y\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/y-720f311276.png\" width=\"14.5\" height=\"20\"> is a vector of length <img alt=\"n\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/n-9baedbc330.png\" width=\"16\" height=\"16\">. Given time step <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">, the <a href=\"https://en.wikipedia.org/wiki/Cash%E2%80%93Karp_method\">Cash-Karp</a> method uses a fifth order Runge-Kutta scheme with a fourth order embedded estimator in order to control the error. In other words, the same intermediate values used in calculating the fifth order update can be used to calculate a fourth order estimate. The difference yields an error estimate, and the error estimate controls the timestep <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">.</p>\n<h2 id=\"install\">Install</h2>\n<pre><code class=\"lang-bash\"><div class=\"line\"><span class=\"source shell\"><span>$&#xA0;npm&#xA0;install&#xA0;ode45-cash-karp</span></span></div>\n</code></pre>\n<h2 id=\"example\">Example</h2>\n<h3 id=\"-van-der-pol-oscillator-https-en-wikipedia-org-wiki-van_der_pol_oscillator-\"><a href=\"https://en.wikipedia.org/wiki/Van_der_Pol_oscillator\">Van der Pol oscillator</a></h3>\n<pre><code class=\"lang-javascript\"><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;ode45&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"support function js\"><span>require</span></span><span class=\"meta brace round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>ode45-cash-karp</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&#xA0;The&#xA0;derivative&#xA0;function&#xA0;for&#xA0;a&#xA0;Van&#xA0;der&#xA0;Pol&#xA0;oscillator:</span><span>&#xA0;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;</span><span class=\"meta function js\"><span class=\"entity name function js\"><span>vanderpol</span></span><span>&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"storage type function js\"><span>function</span></span><span class=\"punctuation definition parameters begin js\"><span>(</span></span><span class=\"variable parameter function js\"><span>dydt</span></span><span class=\"meta object delimiter js\"><span>,</span></span><span>&#xA0;</span><span class=\"variable parameter function js\"><span>y</span></span><span class=\"meta object delimiter js\"><span>,</span></span><span>&#xA0;</span><span class=\"variable parameter function js\"><span>t</span></span><span class=\"punctuation definition parameters end js\"><span>)</span></span></span><span>&#xA0;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;dydt</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta brace square js\"><span>]</span></span><span>&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;y</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>1</span></span><span class=\"meta brace square js\"><span>]</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;dydt</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>1</span></span><span class=\"meta brace square js\"><span>]</span></span><span>&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>4</span></span><span>&#xA0;</span><span class=\"keyword operator js\"><span>*</span></span><span>&#xA0;</span><span class=\"meta brace round js\"><span>(</span></span><span class=\"constant numeric js\"><span>1</span></span><span class=\"keyword operator js\"><span>-</span></span><span>y</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta brace square js\"><span>]</span></span><span class=\"keyword operator js\"><span>*</span></span><span>y</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta brace square js\"><span>]</span></span><span class=\"meta brace round js\"><span>)</span></span><span class=\"keyword operator js\"><span>*</span></span><span>y</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>1</span></span><span class=\"meta brace square js\"><span>]</span></span><span>&#xA0;</span><span class=\"keyword operator js\"><span>-</span></span><span>&#xA0;y</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta brace square js\"><span>]</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta brace curly js\"><span>}</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&#xA0;Initialize:</span><span>&#xA0;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;y0&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta brace square js\"><span>[</span></span><span class=\"constant numeric js\"><span>2</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta brace square js\"><span>]</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;t0&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>0</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;dt0&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>1e-3</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;integrator&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>ode45</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span>&#xA0;y0</span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;vanderpol</span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;t0</span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;dt0&#xA0;</span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&#xA0;Integrate&#xA0;up&#xA0;to&#xA0;tmax:</span><span>&#xA0;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;tmax&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>10</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;t&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta brace square js\"><span>[</span><span>]</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;y&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta brace square js\"><span>[</span><span>]</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"keyword control js\"><span>while</span></span><span class=\"meta brace round js\"><span>(</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>integrator</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>step</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span>&#xA0;tmax&#xA0;</span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span><span>&#xA0;</span><span class=\"meta brace round js\"><span>)</span></span><span>&#xA0;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"punctuation whitespace comment leading js\"><span>&#xA0;&#xA0;</span></span><span class=\"comment line double-slash js\"><span class=\"punctuation definition comment js\"><span>//</span></span><span>&#xA0;Store&#xA0;the&#xA0;solution&#xA0;at&#xA0;this&#xA0;timestep:</span><span>&#xA0;</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;</span><span class=\"variable other object js\"><span>t</span></span><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta brace round js\"><span>(</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>integrator</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>t</span></span><span>&#xA0;</span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;</span><span class=\"variable other object js\"><span>y</span></span><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"support function js\"><span>push</span></span><span class=\"meta brace round js\"><span>(</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>integrator</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"support constant js\"><span>y</span></span><span>&#xA0;</span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta brace curly js\"><span>}</span></span></span></div>\n</code></pre>\n<h3 id=\"common-patterns\">Common patterns</h3>\n<p>A single adaptive step:</p>\n<pre><code>integrator.step()\nintegrator.y      // current state\nintegrator.t      // current time\nintegrator.dt     // newly adapted timestep\n</code></pre><p>A single adaptive step, returning false if <img alt=\"t=1.5\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/t15-27f16b808b.png\" width=\"63.5\" height=\"16\"> reached:</p>\n<pre><code>integrator.step( 1.5 ) // returns true if t &lt; 1.5\nintegrator.step( 1.5 ) // returns false if t = 1.5\n</code></pre><p>Ten adaptive timesteps in sequence:</p>\n<pre><code>integrator.steps( 10 )\n</code></pre><p>Ten timesteps, halting early and returning false if <img alt=\"t=1.5\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/t15-27f16b808b.png\" width=\"63.5\" height=\"16\"> is reached::</p>\n<pre><code>integrator.steps( 10, 1.5 )\n</code></pre><p>Take any number of timesteps until <img alt=\"t=1.5\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/t15-27f16b808b.png\" width=\"63.5\" height=\"16\">:</p>\n<pre><code>integrator.steps( Infinity, 1.5 )\n</code></pre><h2 id=\"api\">API</h2>\n<h4 id=\"-require-ode45-cash-karp-y0-deriv-t0-dt0-options-\"><code>require(&apos;ode45-cash-karp&apos;)( y0, deriv, t0, dt0 [, options] )</code></h4>\n<h4 id=\"arguments-\">Arguments:</h4>\n<ul>\n<li><code>y0</code>: an array or typed array containing initial conditions. This vector is updated in-place with each integrator step.</li>\n<li><code>deriv</code>: a function that calculates the derivative. Format is <code>function( dydt, y, t )</code>. Inputs are current state <code>y</code> and current time <code>t</code>, output is the calculated derivative <code>dydt</code>.</li>\n<li><code>t0</code>: initial time <img alt=\"t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/t-fc93da6f4d.png\" width=\"11.5\" height=\"16\">.</li>\n<li><code>dt0</code>: initial time step <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">.</li>\n<li><code>options</code>: an optional associative array of options. Valid parameters are:<ul>\n<li><code>tol</code>: The target error level to be acheived. Default is: <img alt=\"1 \\cdot 10^{-8}\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/1-cdot-10-8-9ceae48083.png\" width=\"70\" height=\"20\">.</li>\n<li><code>maxIncreaseFactor</code>: The maximum factor by which to increase the timestep if the error tolerance is met. Default value is 10. This limit is applied at the end of a successful timestep.</li>\n<li><code>maxDecreaseFactor</code>: The maximum factor by which to decrease the timestep if the error tolerance is not met. Default value is 10. This limit is applied on each trial step until the error tolerance is acheived.</li>\n<li><code>dtMinMag</code>: The minimum allowed magnitude of <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">. If limit is exceeded during adaptation, a warning is printed to the console and the timestep completes with <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\"> clipped to the the prescribed magnitude. If <code>undefined</code>, this limit is ignored. Default value is <code>undefined</code>.</li>\n<li><code>dtMaxMag</code>: The maximum allowed magnitude of <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">. This limit is applied at the beginning of each step. If a timestep larger than this magnitude is requested, the timestep is executed with <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\"> clipped to the prescribed magnitude. If <code>undefined</code>, this limit is ignored. Default value is <code>undefined</code>.</li>\n<li><code>errorScaleFunction</code>: The function used to compute a normalizing factor for the error in a given dimension. See below for details.</li>\n<li><code>errorReduceFunction</code>: The reduce operation by which errors in each dimension are combined into a single error metric. See below for details.</li>\n<li><code>errorPostFunction</code>: An operation applied to the total error. For example, if using the <img alt=\"L_2\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/l_2-23fd536b11.png\" width=\"26.5\" height=\"19\"> norm this would be a square root. See below for details.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"returns-\">Returns:</h4>\n<p>Initialized integrator object.</p>\n<h4 id=\"properties-\">Properties:</h4>\n<ul>\n<li><code>n</code>: dimension of <code>y0</code>.</li>\n<li><code>y</code>: current state; a reference to input array <code>y0</code>.</li>\n<li><code>deriv</code>: function that calculates the derivative.</li>\n<li><code>t</code>: current time, incremented by <code>dt</code> on each time step.</li>\n<li><code>dt</code>: current time step <img alt=\"\\Delta t\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/delta-t-a20a5fe4f2.png\" width=\"28\" height=\"16\">. Initialized from input <code>dt0</code>. May be changed, but will be overwritten with each adaptive step in order to acheive the prescribed error bound.</li>\n<li>all options are copied to properties on the integrator object and may be changed at any time.</li>\n</ul>\n<h4 id=\"methods-\">Methods:</h4>\n<ul>\n<li><code>.step( [tLimit] )</code>: takes a single step of the integrator and stores the result in-place in the <code>y</code> property. Returns true if <code>tLimit</code> was not provided or if <code>t</code> has not reached the limit, otherwise returns false, meaning <code>t</code> has reached <code>tLimit</code>.</li>\n<li><code>.steps( n, [tLimit] )</code>: takes <code>n</code> steps of the integrator, storing the result in-place in the <code>y</code> property. Exits early if <code>tLimit</code> is reached. Returns true if <code>tLimit</code> was not provided or if <code>t</code> has not reached the limit, otherwise returns false, meaning <code>t</code> has reached <code>tLimit</code>. Note that, for example, <code>.steps( Infinity, 10 )</code> is valid and will take whatever number of step is required to reach <img alt=\"t=10\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/t10-b3a7f6176e.png\" width=\"58\" height=\"16\">.</li>\n</ul>\n<h3 id=\"error-estimation\">Error Estimation</h3>\n<p>Ideally, there would be no choices in error computation since this library would implement the best possible choices, but I&apos;ve left this configurable.</p>\n<h5 id=\"-errorscalefunction-function-i-dt-y-dydt-\"><code>errorScaleFunction: function( i, dt, y, dydt )</code></h5>\n<p>This function receives the dimension number <code>i</code>, the current timestep <code>dt</code>, the current state <code>y</code>, and the derivative calculated at the beginning of the step, <code>dydt</code>. It must return a normalization factor by which the error in the given dimension is normalized. It is executed once at the beginning of each timestep and not for subsequent trial steps. By default, it is:</p>\n<pre><code>function errorScaleFunction( i, dt, y, dydt ) {\n  return Math.abs(y) + Math.abs(dt * dydt) + 1e-32\n}\n</code></pre><h5 id=\"-errorreducefunction-function-i-accumulatederror-errorestimate-\"><code>errorReduceFunction: function( i, accumulatedError, errorEstimate )</code></h5>\n<p>This function performs a reduce operation on the per-dimension error. <code>accumulatedError</code> is initially zero. The function must add the error estimate in dimension <code>i</code> and return a new error estimate. By default, the error reduce function simply returns the maximum error:</p>\n<pre><code>function errorReduceFunction( i, accumulatedError, errorEstimate ) {\n  return Math.max( accumulatedError, Math.abs(errorEstimate))\n}\n</code></pre><h5 id=\"-errorpostfunction-function-accumulatederror-errorestimate-\"><code>errorPostFunction: function( accumulatedError, errorEstimate )</code></h5>\n<p>This function applies a mapping to the total reduced error resulting from <code>errorReduceFunction</code>. For the <img alt=\"L_2\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/l_2-23fd536b11.png\" width=\"26.5\" height=\"19\"> norm, this would just be <code>Math.sqrt</code>; for the <img alt=\"L_\\infty\" valign=\"middle\" src=\"https://raw.githubusercontent.com/scijs/ode45-cash-karp/master/docs/images/l_infty-c904452e37.png\" width=\"34.5\" height=\"19\"> norm, this is simply a no-op:</p>\n<pre><code>function errorPostFunction( accumulatedError ) {\n  return accumulatedError\n}\n</code></pre><h2 id=\"credits\">Credits</h2>\n<p>(c) 2015 Ricky Reusser. MIT License</p>\n"}